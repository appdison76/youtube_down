<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>멜로디 스냅 - 음악 찾기</title>
    <meta name="description" content="음악을 찾고, YouTube에서 검색하고, 다운로드하세요.">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/styles.css">
    <script>
        // API 서버 URL 설정 (Railway 서버 URL로 변경 필요)
        window.API_BASE_URL = 'https://your-railway-server.railway.app';
    </script>
</head>
<body>
    <!-- 헤더 -->
    <header class="app-header">
        <div class="header-content">
            <div class="header-left">
                <div class="logo-container">
                    <img src="logo.png?v=2" alt="Melody Snap" onerror="this.style.display='none'" />
                </div>
                <div class="header-title-container">
                    <div class="header-title">Melody Snap</div>
                </div>
            </div>
            <nav class="nav-tabs">
                <button class="nav-tab active" data-page="recognition">
                    <span class="nav-icon">🎵</span>
                    <span class="nav-text">음악 찾기</span>
                </button>
                <button class="nav-tab" data-page="search">
                    <span class="nav-icon">🔍</span>
                    <span class="nav-text">검색</span>
                </button>
                <button class="nav-tab" data-page="save">
                    <span class="nav-icon">💾</span>
                    <span class="nav-text">저장</span>
                </button>
                <button class="nav-tab" data-page="library">
                    <span class="nav-icon">📚</span>
                    <span class="nav-text">내 저장소</span>
                </button>
            </nav>
        </div>
    </header>

    <!-- 메인 컨텐츠 -->
    <main class="container">
        <!-- 음악 찾기 화면 -->
        <div id="recognition-page" class="page active">
            <div class="recognition-area">
                <button id="recognition-btn" class="recognition-button">
                    <ion-icon name="mic" id="mic-icon" class="recognition-icon"></ion-icon>
                    <ion-icon name="stop" id="stop-icon" class="recognition-icon" style="display: none;"></ion-icon>
                </button>
                <p class="recognition-text" id="recognition-status">음악 찾기를 시작하세요</p>
                <div id="recognition-result" class="recognition-result" style="display: none;">
                    <h3>인식된 곡</h3>
                    <div class="result-card">
                        <img id="result-thumbnail" src="" alt="썸네일" />
                        <div class="result-info">
                            <h4 id="result-title"></h4>
                            <p id="result-artist"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 검색 화면 -->
        <div id="search-page" class="page" style="display: none;">
            <div class="search-area">
                <input type="text" id="search-input" class="search-input" placeholder="YouTube 검색..." />
                <button id="search-btn" class="search-button">검색</button>
                <div id="search-results" class="search-results"></div>
            </div>
        </div>

        <!-- 저장 화면 -->
        <div id="save-page" class="page" style="display: none;">
            <div class="save-area">
                <input type="text" id="url-input" class="url-input" placeholder="YouTube URL 입력 또는 붙여넣기" />
                <button id="url-submit-btn" class="url-submit-button">가져오기</button>
                <div id="video-info" class="video-info" style="display: none;">
                    <img id="video-thumbnail" src="" alt="썸네일" />
                    <div class="video-details">
                        <h3 id="video-title"></h3>
                        <p id="video-author"></p>
                        <div class="video-actions">
                            <button id="download-video-btn" class="action-btn">영상 다운로드</button>
                            <button id="download-audio-btn" class="action-btn">음악 다운로드</button>
                            <button id="favorite-btn" class="action-btn">찜하기</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 내 저장소 화면 -->
        <div id="library-page" class="page" style="display: none;">
            <div class="library-area">
                <div class="library-filters">
                    <button class="filter-btn active" data-filter="all">전체</button>
                    <button class="filter-btn" data-filter="favorite">찜하기</button>
                    <button class="filter-btn" data-filter="downloaded">다운로드</button>
                </div>
                <input type="text" id="library-search" class="library-search" placeholder="검색..." />
                <div id="library-items" class="library-items"></div>
            </div>
        </div>
    </main>

    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script src="js/indexeddb.js"></script>
    <script src="js/api.js"></script>
    <script src="js/recognition.js"></script>
    <script src="js/search.js"></script>
    <script src="js/save.js"></script>
    <script src="js/library.js"></script>
    <script src="js/app.js"></script>
    <script>
        // 브라우저 설정 안내 (직접 열 수 없으므로 명확한 안내 제공)
        function openBrowserSettings() {
            const userAgent = navigator.userAgent.toLowerCase();
            let message = '';
            
            if (userAgent.includes('android')) {
                // Android 브라우저 (최신 버전 대응)
                message = '📱 Android 브라우저 마이크 권한 설정:\n\n' +
                         '방법 1 (가장 쉬움):\n' +
                         '→ 브라우저 메뉴(⋮) 클릭 (화면 오른쪽 상단)\n' +
                         '→ "사이트 설정" 또는 "권한" 찾기\n' +
                         '→ "마이크" → "허용"으로 변경\n\n' +
                         '방법 2:\n' +
                         '→ 브라우저 메뉴(⋮) → 설정\n' +
                         '→ "사이트 설정" → "마이크"\n' +
                         '→ 이 사이트를 찾아 "허용"으로 변경\n\n' +
                         '방법 3:\n' +
                         '→ 주소창의 아이콘이 보이면 클릭\n' +
                         '→ "사이트 설정" → "마이크" → "허용"\n\n' +
                         '💡 브라우저 버전에 따라 메뉴 위치가 다를 수 있습니다.';
            } else if (userAgent.includes('iphone') || userAgent.includes('ipad')) {
                // iOS Safari
                message = '📱 iOS Safari 마이크 권한 설정:\n\n' +
                         '방법 1 (가장 쉬움):\n' +
                         '→ 주소창 왼쪽의 "aA" 아이콘 클릭\n' +
                         '→ "사이트 설정" 또는 "웹사이트 설정"\n' +
                         '→ "마이크" → "허용"으로 변경\n\n' +
                         '방법 2:\n' +
                         '→ 설정 앱 → Safari\n' +
                         '→ "카메라" 또는 "마이크" 허용 확인\n\n' +
                         '방법 3:\n' +
                         '→ Safari에서 주소창의 자물쇠 아이콘 클릭\n' +
                         '→ "웹사이트 설정" → "마이크" 허용';
            } else {
                // Desktop (최신 브라우저 대응)
                message = '💻 데스크톱 브라우저 마이크 권한 설정:\n\n' +
                         '방법 1 (가장 쉬움):\n' +
                         '→ 브라우저 메뉴(⋮) 클릭 (화면 오른쪽 상단)\n' +
                         '→ "설정" → "개인정보 및 보안" → "사이트 설정"\n' +
                         '→ "마이크" → 이 사이트를 허용 목록에 추가\n\n' +
                         '방법 2:\n' +
                         '→ 주소창의 아이콘이 보이면 클릭\n' +
                         '→ "사이트 설정" 또는 "권한" → "마이크" → "허용"\n\n' +
                         '방법 3 (Chrome/Edge):\n' +
                         '→ 주소창에 입력: chrome://settings/content/microphone\n' +
                         '→ 이 사이트를 허용 목록에 추가\n\n' +
                         '방법 4 (Firefox):\n' +
                         '→ 브라우저 메뉴(☰) → 설정\n' +
                         '→ "개인 정보 및 보안" → "권한" → "마이크"\n\n' +
                         '💡 브라우저 버전에 따라 메뉴 구조가 다를 수 있습니다.';
            }
            
            // 모달 스타일의 안내 표시
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 24px;
                border-radius: 12px;
                max-width: 400px;
                width: 100%;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;
            
            const text = document.createElement('div');
            text.style.cssText = `
                white-space: pre-line;
                line-height: 1.6;
                color: #333;
                font-size: 14px;
                margin-bottom: 16px;
            `;
            text.textContent = message;
            
            const closeBtn = document.createElement('button');
            closeBtn.textContent = '닫기';
            closeBtn.style.cssText = `
                width: 100%;
                padding: 12px;
                background: #FF0000;
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 16px;
                cursor: pointer;
                font-weight: bold;
            `;
            closeBtn.onclick = () => {
                document.body.removeChild(modal);
            };
            
            content.appendChild(text);
            content.appendChild(closeBtn);
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // 모달 외부 클릭 시 닫기
            modal.onclick = (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
        }
    </script>
</body>
</html>
